{% comment %}
  Section: Video with Text
  Description: Apresenta um bloco de vídeo (interno ou externo) ao lado de conteúdo textual.
{% endcomment %}

<section
  class="section {{ section.settings.spacing }} {% if section.settings.full_width %}full-width{% endif %}"
  data-section-id="{{ section.id }}"
>
  <div class="container">
    {% for block in section.blocks %}
      {% assign video = block.settings.video %}
      {% assign external_video_url = block.settings.external_video_url %}
      {% assign poster = block.settings.poster_image %}
      {% assign autoplay = block.settings.autoplay %}
      {% assign media_position = block.settings.media_position %}
      {% assign media_width = block.settings.media_width | append: '%' %}
      {% assign text_alignment = block.settings.text_position %}

      <div class="media-with-text-block flex flex-wrap items-center gap-6 my-12 {% if media_position == 'end' %}flex-row-reverse{% endif %}">
        <div class="media w-full md:w-[{{ media_width }}]">
          {% if video != blank %}
            {{ video | video_tag: autoplay: autoplay, controls: true, loop: true, muted: autoplay, playsinline: true, poster: poster }}
          {% elsif external_video_url != blank %}
            <div class="aspect-video w-full">
              <iframe
                class="w-full h-full"
                src="{{ external_video_url | replace: 'watch?v=', 'embed/' }}"
                frameborder="0"
                allowfullscreen
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              ></iframe>
            </div>
          {% endif %}
        </div>

        <div class="text-content w-full md:w-[calc(100%-{{ media_width }})] text-{{ text_alignment }}">
          {% if block.settings.custom_icon != blank %}
            <img src="{{ block.settings.custom_icon | image_url: width: block.settings.icon_width }}" alt="Ícone" width="{{ block.settings.icon_width }}" class="mb-2">
          {% elsif block.settings.icon != 'none' %}
            <span class="icon icon-{{ block.settings.icon }} mb-2" style="width: {{ block.settings.icon_width }}px;"></span>
          {% endif %}

          {% if block.settings.subheading != blank %}
            <p class="subheading text-sm text-gray-500">{{ block.settings.subheading }}</p>
          {% endif %}

          {% if block.settings.title != blank %}
            <h2 class="title text-2xl font-bold mt-1" {% if block.settings.text_gradient != blank %}style="background: {{ block.settings.text_gradient }}; -webkit-background-clip: text; color: transparent;"{% endif %}>{{ block.settings.title }}</h2>
          {% endif %}

          {% if block.settings.content != blank %}
            <div class="content text-base mt-2" style="color: {{ block.settings.text_color }};">
              {{ block.settings.content }}
            </div>
          {% endif %}

          {% if block.settings.link_text != blank and block.settings.link_url != blank %}
            <a href="{{ block.settings.link_url }}" class="btn mt-4 inline-block px-5 py-2 rounded text-{{ block.settings.button_text_color }} bg-{{ block.settings.button_background }}">
              {{ block.settings.link_text }}
            </a>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
</section>

{% schema %}
{
  "name": "Vídeo com Texto",
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Largura total",
      "default": false
    },
    {
      "type": "select",
      "id": "spacing",
      "label": "Espaçamento da seção",
      "default": "pt-12 pb-12",
      "options": [
        { "value": "pt-8 pb-8", "label": "Pequeno" },
        { "value": "pt-12 pb-12", "label": "Médio" },
        { "value": "pt-16 pb-16", "label": "Grande" }
      ]
    }
  ],
  "blocks": [
    {
      "type": "video_block",
      "name": "Bloco de Vídeo",
      "settings": [
        {
          "type": "video",
          "id": "video",
          "label": "Vídeo interno"
        },
        {
          "type": "url",
          "id": "external_video_url",
          "label": "URL do vídeo externo (YouTube, Vimeo etc.)"
        },
        {
          "type": "image_picker",
          "id": "poster_image",
          "label": "Imagem de capa do vídeo (poster)"
        },
        {
          "type": "checkbox",
          "id": "autoplay",
          "label": "Reproduzir automaticamente",
          "default": false
        },
        {
          "type": "select",
          "id": "media_position",
          "label": "Posição do vídeo",
          "default": "start",
          "options": [
            { "value": "start", "label": "Esquerda" },
            { "value": "end", "label": "Direita" }
          ]
        },
        {
          "type": "range",
          "id": "media_width",
          "label": "Largura do vídeo (%)",
          "min": 30,
          "max": 70,
          "step": 5,
          "default": 50
        },
        {
          "type": "select",
          "id": "text_position",
          "label": "Alinhamento do texto",
          "default": "left",
          "options": [
            { "value": "left", "label": "Esquerda" },
            { "value": "center", "label": "Centralizado" },
            { "value": "right", "label": "Direita" }
          ]
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "Subtítulo"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Título"
        },
        {
          "type": "textarea",
          "id": "content",
          "label": "Texto descritivo"
        },
        {
          "type": "select",
          "id": "icon",
          "label": "Ícone padrão",
          "default": "none",
          "options": [
            { "value": "none", "label": "Nenhum" },
            { "value": "star", "label": "Estrela" },
            { "value": "check", "label": "Check" },
            { "value": "heart", "label": "Coração" }
          ]
        },
        {
          "type": "image_picker",
          "id": "custom_icon",
          "label": "Ícone personalizado"
        },
        {
          "type": "range",
          "id": "icon_width",
          "label": "Largura do ícone (px)",
          "min": 10,
          "max": 100,
          "step": 1,
          "default": 40
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Cor do texto",
          "default": "#000000"
        },
        {
          "type": "color_background",
          "id": "text_gradient",
          "label": "Gradiente no título"
        },
        {
          "type": "url",
          "id": "link_url",
          "label": "Link do botão"
        },
        {
          "type": "text",
          "id": "link_text",
          "label": "Texto do botão"
        },
        {
          "type": "color",
          "id": "button_background",
          "label": "Cor de fundo do botão",
          "default": "#000000"
        },
        {
          "type": "color",
          "id": "button_text_color",
          "label": "Cor do texto do botão",
          "default": "#ffffff"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Vídeo com Texto",
      "blocks": [
        {
          "type": "video_block"
        }
      ]
    }
  ]
}
{% endschema %}

{% stylesheet %}
  .media-with-text-block .icon {
    display: inline-block;
    height: auto;
  }
{% endstylesheet %}
